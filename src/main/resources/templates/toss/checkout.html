<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://static.toss.im/icons/png/4x/icon-toss-logo.png" />
    <link rel="stylesheet" type="text/css" href="/toss/style.css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>식사 정산 결제</title>
    <!-- 토스페이먼츠 SDK 추가 -->
    <script src="https://js.tosspayments.com/v2/standard"></script>
</head>

<body>
<!-- 주문서 영역 -->
<div class="wrapper">
    <div class="box_section" style="padding: 40px 30px 50px 30px; margin-top: 30px; margin-bottom: 50px">
        <!-- 결제 정보 표시 -->
        <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 10px 0;">결제 정보</h3>
            <p style="margin: 5px 0;">주문번호: <span id="order-id-display">-</span></p>
            <p style="margin: 5px 0;">결제금액: <span id="amount-display">-</span>원</p>
        </div>

        <!-- 결제 UI -->
        <div id="payment-method"></div>
        <!-- 이용약관 UI -->
        <div id="agreement"></div>

        <!-- 결제하기 버튼 -->
        <div class="result wrapper">
            <button class="button" id="payment-button" style="margin-top: 30px">
                결제하기
            </button>
        </div>
    </div>
</div>


<script th:inline="javascript">
    const orderId = /*[[${orderId}]]*/ "";
    const amountValue = Number(/*[[${amount}]]*/ 0);
    const orderName = '식사 정산 결제';
</script>

<script>
    main();

    async function main() {
        // 화면 표시
        document.getElementById('order-id-display').textContent = orderId;
        document.getElementById('amount-display').textContent =
            amountValue.toLocaleString();

        const amount = {
            currency: "KRW",
            value: amountValue,
        };

        const clientKey = "test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm";
        const customerKey = generateRandomString();

        const tossPayments = TossPayments(clientKey);
        const widgets = tossPayments.widgets({ customerKey });

        await widgets.setAmount(amount);

        await widgets.renderPaymentMethods({
            selector: "#payment-method",
            variantKey: "DEFAULT",
        });

        await widgets.renderAgreement({
            selector: "#agreement",
            variantKey: "AGREEMENT",
        });

        document.getElementById("payment-button")
            .addEventListener("click", async () => {
                await widgets.requestPayment({
                    orderId: orderId,
                    orderName: orderName,
                    successUrl: location.origin + "/payment/success",
                    failUrl: location.origin + "/payment/fail",
                });
            });
    }

    function generateRandomString() {
        return window.btoa(Math.random()).slice(0, 20);
    }
</script>

</body>
</html>